---
title: "p8105_hw2_xs2330"
author: "Xiao Shi"
date: "September 26, 2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
```

## Problem 1
**Import, select, and tidy data**
```{r prob1 import data, message=FALSE}
NYC_Transit = 
  read_csv("./data_hw2/nyc_subway.csv") %>%
  janitor::clean_names() %>%
  select(line, station_name, station_latitude, station_longitude, route1, route2, route3, route4, route5, 
         route6, route7, route8, route9, route10, route11, entry, vending, entrance_type, ada)
head(NYC_Transit)
NYC_Transit$entry = ifelse(NYC_Transit$entry == 'YES', TRUE,FALSE)
```

The `NYC_transit` dataset contains detailed information on station, routing, staffing, ada compliance, and vending. I used the janitor package to clean up the original data, and used the select function to choose the variables that will be focused on for this analysis. The dimension is `r nrow(NYC_Transit)` rows by `r ncol(NYC_Transit)` columns. However, the data is NOT tidy yet because the route number (variables route1 to route11) is spread across 11 columns.

**Distinct stations**
```{r}
distin_line = distinct(NYC_Transit[,c("line","station_name")])
head(distin_line)
```
The amount of distinct stations is `r nrow(distin_line)`

**Ada-compliant data**
```{r}
distin_ada_comp = select(NYC_Transit, line, station_name, ada) %>%
  distinct() %>%
  filter(ada == "TRUE")
head(distin_ada_comp)
```
There are `r nrow(distin_ada_comp)` stations that are ADA compliant

**Proportion of station exits without vending that allow entrance**
```{r}
distin_entry_novend = select(NYC_Transit, line, station_name, entry, vending) %>%
  distinct() %>%
  filter(vending == "NO")
head(distin_entry_novend)
prop_entry_novend = mean(distin_entry_novend$entry == "TRUE")
```
The proportion of station entrances / exits without vending allow entrance is `r prop_entry_novend`

**Reformat to tidy data**
```{r}
NYC_Transit = gather(NYC_Transit, key = "route_number", value = "route_name", route1:route11)
station_line_a = distinct(NYC_Transit[,c("line","station_name","route_name","ada")]) %>%
  filter(route_name == "A")
station_line_a_ada = filter(station_line_a, ada == TRUE)
```
There are `r nrow(station_line_a)` distinct stations that serves the A train  
There are `r nrow(station_line_a_ada)` distinct stations that serves the A train that are also ADA compliant

## Problem 2
**Read and clean Mr.Trash Wheel data**
```{r}
dumps = 
  read_excel("./data_hw2/HealthyHarborWaterWheelTotals2017-9-26.xlsx",sheet = 'Mr. Trash Wheel', range = cell_cols(1:14)) %>%
  janitor::clean_names() %>%
  na.omit(dumps)
head(dumps)
dumps$sports_balls = as.integer(dumps$sports_balls)
```

**Read and clean Precip data for year 2016 and 2017**
```{r}
precip_2016 = read_excel("data_hw2/HealthyHarborWaterWheelTotals2017-9-26.xlsx",sheet = '2016 Precipitation',
                         range = "A2:B14") %>%
  na.omit(precip_2016)
colnames(precip_2016) = c("month", "total_precip_16")
precip_2016$year_16 = 2016

precip_2017 = read_excel("data_hw2/HealthyHarborWaterWheelTotals2017-9-26.xlsx",sheet = '2017 Precipitation',
                         range = "A2:B14") %>%
  na.omit(precip_2017)
colnames(precip_2017) = c("month", "total_precip_17")
precip_2017$year_17 = 2017
```
**Combine precip data for year 2016 and 2017**
```{r}
precip_1617 = left_join(precip_2016, precip_2017,by = "month")
precip_1617$month = month.name
head(precip_1617)
```

**Summary of problem2 data**     
The number of observations in the trash wheel data is `r nrow(dumps)` rows by `r ncol(dumps)` columns. The number of observations in the precipitation data is `r nrow(precip_1617)` rows by `r ncol(precip_1617)` columns. Key variables in the trash wheel data includes trash wheel index by `dumpster`, date of collection by `date`, weight of the specific trash wheel by `weight_tons`, and types of trash collected such as `plastic_bottles`, `chips_bag`, and `sports_balls`. Key variables in the precipitation data includes precipitation data such as `total_precip_16` and `total_precip_17` for the year 2016 and 2017, by month. The total precipitation in 2017 was `r sum(precip_1617$total_precip_17, na.rm = TRUE)`. The median number of sports balls in the dumpster in 2016 was `r median(dumps$sports_balls)`.

## Problem 3
**load data from p8105 package**
```{r loading data}
library(p8105.datasets)
```
**tidy and manipulate data**
```{r}
brfss = brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(str_detect(topic, "Overall Health") == TRUE) %>%
  select(year, locationabbr, locationdesc, response, data_value) %>%
  spread(key = response, value = data_value) %>%
  janitor::clean_names() %>%
  mutate(exc_vgood = excellent + very_good)
head(brfss)
```

**unique locations**
```{r}
num_uniq_location = length(unique(brfss$locationdesc))
num_uniq_states = length(unique(brfss$locationabbr))
freq_state = plyr::count(brfss, "locationabbr")
highest_fre_state = freq_state[which.max(freq_state$freq),1]
```
The number of unique locations is `r num_uniq_location`. The number of states that's been represented
is `r num_uniq_states`. Since all 50 states are included, we conclude that all states are represented. `r highest_fre_state` is observed the most.

**Excellent response in 2002**
```{r}
brfss_2002 = filter(brfss,year == 2002)
medi_2002_excellent = median(brfss_2002$excellent, na.rm = TRUE)
```
The median of the excellent response value is `r medi_2002_excellent`.

